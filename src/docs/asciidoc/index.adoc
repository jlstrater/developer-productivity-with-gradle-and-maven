= Fast and reliable builds with +++<br>+++Gradle and Maven
:title-slide-background-image: title.jpeg
:title-slide-transition: zoom
:title-slide-transition-speed: fast
:revnumber: {project-version}
ifndef::imagesdir[:imagesdir: images]
ifndef::sourcedir[:sourcedir: ../java]
:deckjs_transition: fade
:navigation:
:menu:
:status:

https://twitter.com/marcphilipp[Marc Philipp (@marcphilipp), Gradle Inc.]

== About me

[source,kotlin]
----
speaker {
    name = "Marc Philipp"
    home = "Karlsruhe, Germany"
    company = "Gradle Inc."
    title = "Senior Software Engineer"
    openSourceRoles = [
        "JUnit team lead"
    ]
    twitter = "@marcphilipp"
    github = "marcphilipp"
    web = uri("https://www.marcphilipp.de")
}
----

=== Gradle Inc.

* Build Happiness
* Products
** Gradle Build Tool
** Gradle Enterprise

=== How do builds affect developer productivity?

[%step]
* _failures:_ about 20% of builds fail due to code defects
  - 5-10% of a team's capacity is spent on fixing
* _slowness:_ a team's capacity is reduced by 4% for each extra minute of build time
* _unreliability:_ 5% of a team's capacity goes into debugging build problems

[NOTE.speaker]
--
Why is the Build so critical?

Builds are executed many, many times a day to constantly transform new code into software, to test it, to run it, to get any kind of feedback. The large teams build up to 100000 times a day.

Builds are code written on top of a build system, often hundred thousands or even millions of lines of code that are constantly evolving. The input of the build is constantly changing and affecting its efficiency. If such a build is not continuously managed and monitored, performance and reliability issues will severely affect the development productivity.

A single build execution takes a non-trivial amount of time, easily several minutes, often more than that. Waiting for the build to finish is often dead time for developers. One minute of extra build time per build destroys in average 4% of engineering capacity.

It is the job of the build to integrate all the latest code changes, run the tests and other checks to make sure that everything is still working. In average 20% of all builds fail because of code defects. This is fine and is actually the job of the build. But it often takes way too long to find the cause for such a failure. Easily 5-10% of engineering capacity are spend on this. Netflix has done internal studies that show that this consumes 20% of their engineering capacity.

The build code itself has often reliability issues. This is comparable to the assembly line and machines in a factory not working properly. Those problems are very hard to debug and can cause a lot of harm. Depending on the organization this can destroy 5% or more of their engineering capacity.

The build touches everything related to software development and provides a unique and valuable set of data if harvested. Not using this data makes it impossible to do develop software efficiently.

Every software team on the planet is severely affected by all those issues including a deep lack of insight. This is why we build GE.
--

== Fast builds

=== Fast builds

* faster = avoid doing needless work
* reuse results!
** incremental builds
** build cache

=== Incremental builds

* Gradle üëç
* Maven üëé

=== Incremental builds

Gradle can reuse results +
of the *last time* +
*this build* ran +
on *this machine*.

=== We can do better!

=== Why not...

of *any time* +
and *any build* +
that ran *anywhere*.

=== Even better

For Maven and Gradle builds!

[%notitle]
=== Maven vs. Gradle

image::maven-vs-gradle.png[height=auto]

=== Build Cache for Gradle

[%step]
[source,text]
----
$> gradle --build-cache assemble
:compileJava FROM-CACHE
:processResources
:classes
:jar
:assemble

BUILD SUCCESSFUL
----

=== Build Cache for Gradle

* out-of-the-box for Java, Groovy, Scala, C++ and Swift projects
* supports compile, test and verification tasks
* high-performance remote backend from Gradle
* Docker Hub: https://hub.docker.com/r/gradle/build-cache-node/[gradle/build-cache-node]

=== Build Cache for Maven

* custom extension (part of Gradle Enterprise)
* initial release: March 2019
* supported plugins: Java Compiler, Surefire/Failsafe, Javadoc, JAXB, Checkstyle

=== Build Cache ‚Äì Demo

=== How does it work?

- Calculate _cacheKey_ of a task/goal from its inputs:
  _cacheKey(javaCompile)_ = _hash(sourceFiles, ...)_
- Store its outputs under _cacheEntry_:
  _cacheEntry(javaCompile)_ = _fileTree(classFiles)_

[.stretch.plain]
image::task_inputs_outputs.svg[]

=== Local and remote cache

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-01.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-02.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-03.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-04.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-05.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-06.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-07.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-08.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-09.svg[]

[%notitle,transition=none]
=== Local and remote cache

[.stretch.plain]
image::caching-typical-scenario-10.svg[]

== Reliable builds

=== Requirements

* monitoring of builds to discover regressions/improvements
** both builds by developers and CI
** reliability
** performance

=== What are Build Scans?

* persistent record of what happened during a build
* permanent and shareable URL
* for developers and build engineers

=== Gradle

[source,text]
----
$> gradle build --scan
...
BUILD SUCCESSFUL in 8m 22s
418 actionable tasks: 112 executed, 48 from cache, 258 up-to-date

Publishing build scan...
https://scans.gradle.com/s/lbmn7n4dngqgq
----

=== Maven

(with extension registered in `.mvn/extensions.xml`)

[source,text]
----
$> mvn clean verify
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  5.262 s
[INFO] Finished at: 2019-04-23T09:55:36+02:00
[INFO] ------------------------------------------------------------------------
[INFO] 13 goals, 8 executed, 5 from cache, saving at least 16s
[INFO]
[INFO] Publishing build scan...
[INFO] https://gradle.com/s/ypgljbvelzxzs
[INFO]
----

=== Build Scans ‚Äì Demo

[NOTE.speaker]
--
* Navigate to summary, open performance tab, open timeline tab, open plugins view
* Show scan list
* Build categorization via Tags
--

=== Build Scans

* support Gradle _and_ Maven
* public scans are free on link:https://scans.gradle.com[scans.gradle.com]
** https://scans.gradle.com/s/nq7w6cjm72mak/
** without build comparison, performance dashboard etc.
* Gradle Enterprise provides additional features and on-premise hosting

=== Custom analyses

* use Export API
* https://github.com/gradle/build-analysis-demo

image::build-analysis-data-pipeline.png[width=80%, height=auto]

[NOTE.speaker]
--
* Gradle Enterprise wird einige Analysen bekommen
* Gradle Enterprise soll kein BI Tool werden - gute Einsichten out-of-the-box, der Rest via Export API m√∂glich
--

[%notitle]
=== Dashboard

image::build-dashboard.png[height=auto]

[%notitle]
=== Dashboard

image::test-analytics.png[height=auto]

[NOTE.speaker]
--
√úber Flaky Test reden.
--

== Resources

//* Slides: https://wolfs.github.io/talk-developer-productivity-day-2019
* Free trainings on https://gradle.com/training/[], e.g.
  - Build Cache Deep Dive
  - Maven + Gradle Enterprise
* https://www.youtube.com/channel/UCvClhveoEjokKIuBAsSjEwQ/videos[YouTube channel]
* Gradle Build Tool: https://gradle.org[]
* Gradle Enterprise: https://gradle.com[]

=== –î—è–∫—É—é!

See you tomorrow?

[.plain, height=150px]
image::junit5-logo.svg[]

https://jeeconf.com/program/news-from-junit-5-x-from-revolution-to-continuous-evolution/[*News from JUnit 5.x*] +
_From Revolution to Continuous Evolution_ +
Tomorrow, 16:10, Track C +
