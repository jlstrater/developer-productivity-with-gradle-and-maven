= Fast and reliable builds with Gradle and Maven
:title-slide-background-image: title.jpeg
:title-slide-transition: zoom
:title-slide-transition-speed: fast
:revnumber: {project-version}
ifndef::imagesdir[:imagesdir: images]
ifndef::sourcedir[:sourcedir: ../java]
:deckjs_transition: fade
:navigation:
:menu:
:status:

https://twitter.com/marcphilipp[Marc Philipp (@marcphilipp)], Gradle Inc.

== Who am I?

[source,kotlin]
----
speaker {
    name = "Marc Philipp"
    company = "Gradle Inc"
    title = "Senior Software Engineer"
    openSourceRoles = [
        "JUnit team lead"
    ],
    twitter = '@marcphilipp'
    github = "marcphilipp"
    web = uri("https://www.marcphilipp.de")
}
----

== Gradle Inc.

* Build Happiness
* Products
** Gradle Build Tool
** Gradle Enterprise

== How do builds affect developer productivity?

* _failures:_ about 20% of builds fail due to code defects
  - 5-10% of a team's capacity is spent on fixing
* _slow:_ a team's capacity is reduced by 4% for each extra minute of build time
* _unreliable:_ 5% of a team's capacity goes into debugging build problems

[NOTE.speaker]
--
Why is the Build so critical?

Builds are executed many, many times a day to constantly transform new code into software, to test it, to run it, to get any kind of feedback. The large teams build up to 100000 times a day.

Builds are code written on top of a build system, often hundred thousands or even millions of lines of code that are constantly evolving. The input of the build is constantly changing and affecting its efficiency. If such a build is not continuously managed and monitored, performance and reliability issues will severely affect the development productivity.

A single build execution takes a non-trivial amount of time, easily several minutes, often more than that. Waiting for the build to finish is often dead time for developers. One minute of extra build time per build destroys in average 4% of engineering capacity.

It is the job of the build to integrate all the latest code changes, run the tests and other checks to make sure that everything is still working. In average 20% of all builds fail because of code defects. This is fine and is actually the job of the build. But it often takes way too long to find the cause for such a failure. Easily 5-10% of engineering capacity are spend on this. Netflix has done internal studies that show that this consumes 20% of their engineering capacity.

The build code itself has often reliability issues. This is comparable to the assembly line and machines in a factory not working properly. Those problems are very hard to debug and can cause a lot of harm. Depending on the organization this can destroy 5% or more of their engineering capacity.

The build touches everything related to software development and provides a unique and valuable set of data if harvested. Not using this data makes it impossible to do develop software efficiently.

Every software team on the planet is severely affected by all those issues including a deep lack of insight. This is why we build GE.
--

== Fast builds

=== Fast builds

* faster = avoid doing needless work
* reuse results!
** incremental builds
** build cache

=== Incremental builds

* Gradle üëç
* Maven üëé

=== Incremental builds

Gradle can reuse results +
of the *last time* +
*this build* ran +
on *this machine*.

image::task_inputs_outputs.svg[width=380px, height=auto]

=== We can do better!

=== Why not...

of *any time*‚Ä® +
and *any build* +
that ran *anywhere*.

image::build_caching.svg[width=380px, height=auto]

=== Even better

* Maven and Gradle

[%notitle]
=== Maven vs. Gradle

image::maven-vs-gradle.png[height=auto]

=== Gradle

[%step]
[source,text]
----
$> gradle --build-cache assemble
:compileJava FROM-CACHE
:processResources
:classes
:jar
:assemble

BUILD SUCCESSFUL
----

=== Gradle

* usable for Java, Groovy, Scala, C++ and Swift projects
* supports compile, test and verification tasks
* high-performance backend from Gradle
* Dockerhub: https://hub.docker.com/r/gradle/build-cache-node/[gradle/build-cache-node]

=== Maven

* custom extension (part of Gradle Enterprise)
* initial release: March 2019
  - compile/test-compile and surefire/failsafe plugins
* more to come in the next version (Javadoc, JAXB)

== Reliable builds

=== Requirements

* monitoring of builds to discover regressions/improvements
** both builds by developers and CI
** reliability
** performance

=== What are Build Scans?

* persistent record of what happened during a build
* permanent and shareable URL
* for developers and build engineers

=== Build Scans ‚Äì Demo

* https://e.grdev.net/s/37h3dlueevh2s[build scan]
* https://e.grdev.net/scans[scan list]
* https://e.grdev.net/scans?search.tags=local[local builds]

[NOTE.speaker]
--
* Navigate to summary, open performance tab, open timeline tab, open plugins view
* Show scan list
* Build categorization via Tags
--
[%notitle]
=== Maven Build Scans ‚Äì Summary
image::maven-scan-summary.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Timeline
image::maven-scan-timeline.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Performance
image::maven-scan-performance.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Performance Configuration
image::maven-scan-performance-conf.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Performance Goals
image::maven-scan-performance-goals.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Performance Build Cache
image::maven-scan-performance-build-cache.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Projects
image::maven-scan-projects.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Plugins
image::maven-scan-plugins.png[height=80%]

[%notitle]
=== Maven Build Scans ‚Äì Switches Infrastructure
image::maven-scan-switches-infrastructure.png[height=80%]

=== Build Scans

* support Gradle _and_ Maven
* public scans are free on link:https://scans.gradle.com[scans.gradle.com]
** https://scans.gradle.com/s/nq7w6cjm72mak/
** without build comparison
* Gradle Enterprise provides additional features and on-premise hosting

=== Gradle

[source,text]
----
$> gradle build --scan
...
BUILD SUCCESSFUL in 8m 22s
418 actionable tasks: 112 executed, 48 from cache, 258 up-to-date

Publishing build scan...
https://scans.gradle.com/s/lbmn7n4dngqgq
----

=== Maven

* extension registered in `.mvn/extensions.xml`

// TODO update console output

[source,text]
----
$> mvn package
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  26.507 s
[INFO] Finished at: 2019-02-13T18:45:26+01:00
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] Publishing build scan...
[INFO] https://scans.gradle.com/s/4r5fubfnzjo54
[INFO]
----

=== Performance dashboard

* example: performance regression
* https://e.grdev.net/scans/performance?list.offset=0&list.size=50&list.sortColumn=startTime&list.sortOrder=desc&search.startTimeMax=1549321199999&search.startTimeMin=1548543600000&search.tags=CI&search.tags=not:RERUN_TESTS&search.tags=master&search.tags=SanityCheck[last week]
* https://e.grdev.net/scans/performance?list.offset=0&list.size=50&list.sortColumn=startTime&list.sortOrder=desc&search.startTimeMax=1550080479731&search.startTimeMin=1549475679731&search.tags=CI&search.tags=not:RERUN_TESTS&search.tags=master&search.tags=SanityCheck[current]

=== Cache misses

* custom tags for unexpected cache misses
* example: Gradle build
  - https://e.grdev.net/scans?list.offset=0&list.size=50&list.sortColumn=startTime&list.sortOrder=desc&search.tags=cache_miss[all cache misses]
  - https://e.grdev.net/s/asqxkwl6ib46y[one specific case]
  - https://e.grdev.net/c/asqxkwl6ib46y/ea6nucbz4bvf6/task-inputs?toggledFileChanges=WyI3Z2hjdWhyb3pscHdtLWZpbGUtaW5wdXQtMCIsIjdnaGN1aHJvemxwd20tMC0wIiwiZmt2dXk3cXlqZ3Rtby1maWxlLWlucHV0LTAiLCJma3Z1eTdxeWpndG1vLTAtMCIsInhqeGRhcnl5emJzeXEtZmlsZS1pbnB1dC0wIiwieGp4ZGFyeXl6YnN5cS0wLTAiXQ#change-xjxdaryyzbsyq-0-0-0[comparison]

=== Custom analyses

* use Export API
* https://github.com/gradle/build-analysis-demo

image::build-analysis-data-pipeline.png[width=80%, height=auto]

[NOTE.speaker]
--
* Gradle Enterprise wird einige Analysen bekommen
* Gradle Enterprise soll kein BI Tool werden - gute Einsichten out-of-the-box, der Rest via Export API m√∂glich
--

[%notitle]
=== Dashboard

image::build-dashboard.png[height=auto]

[%notitle]
=== Dashboard

image::test-analytics.png[height=auto]

[NOTE.speaker]
--
√úber Flaky Test reden.
--

== Thank you!

//* Slides: https://wolfs.github.io/talk-developer-productivity-day-2019
* https://gradle.org/training/[]
  - Build Cache Deep Dive
  - Maven + Gradle Enterprise
* https://www.youtube.com/channel/UCvClhveoEjokKIuBAsSjEwQ/videos[Youtube channel]
* Gradle Enterprise: https://gradle.com[]
